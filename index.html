<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Contratação</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/imask"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        eluria: {
                            navy: '#050A30',
                            navyLight: '#1a245a',
                            slate: '#F8FAFC',
                            border: '#E2E8F0',
                            text: '#1E293B',
                            muted: '#64748B'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F1F5F9;
            color: #1E293B;
        }

        /* Professional Input Styling */
        .form-field {
            @apply flex flex-col gap-2;
        }

        .form-label {
            @apply text-sm font-bold text-eluria-navy tracking-tight ml-1;
        }

        .input-wrapper {
            @apply relative flex items-center;
        }

        .form-input {
            @apply w-full pl-11 pr-12 py-3.5 bg-white border-2 border-slate-200 rounded-xl text-slate-900 font-medium transition-all duration-200 outline-none;
        }

        .form-input:focus {
            @apply border-eluria-navy ring-4 ring-eluria-navy/5 bg-white;
        }

        .form-input::placeholder {
            @apply text-slate-300 font-normal;
        }

        /* Icon Styling */
        .prefix-icon {
            @apply absolute left-4 text-slate-400 w-5 h-5 transition-colors duration-200;
        }

        .form-input:focus ~ .prefix-icon {
            @apply text-eluria-navy;
        }

        /* Section Header - High Professionalism */
        .section-header {
            @apply bg-eluria-navy text-white px-6 py-4 rounded-t-2xl flex items-center gap-3 shadow-md;
        }

        .section-content {
            @apply bg-white p-8 rounded-b-2xl shadow-sm border-x border-b border-slate-100 mb-10;
        }

        /* Validation States */
        .is-valid .form-input { @apply border-emerald-100 bg-emerald-50/30; }
        .is-valid .prefix-icon { @apply text-emerald-500; }
        
        .is-invalid .form-input { @apply border-rose-200 bg-rose-50/50; }
        .is-invalid .prefix-icon { @apply text-rose-500; }

        .validation-indicator {
            @apply absolute right-4 w-5 h-5 opacity-0 transition-opacity duration-200;
        }
        .is-valid .icon-valid { @apply opacity-100 text-emerald-500; }
        .is-invalid .icon-invalid { @apply opacity-100 text-rose-500; }

        /* Progress Bar */
        #progress-bar {
            @apply fixed top-0 left-0 h-1.5 bg-eluria-navy transition-all duration-500 ease-out z-50 shadow-sm;
        }

        .error-hint {
            @apply text-rose-500 text-[11px] font-bold mt-1 ml-1 hidden;
        }
        .is-invalid .error-hint { @apply block; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #050A30; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen pb-20 antialiased">
    <div id="progress-bar" style="width: 0%"></div>

    <div class="max-w-4xl mx-auto px-4 pt-16">
        <!-- Success State -->
        <div id="successState" class="hidden bg-white p-12 md:p-24 rounded-[2.5rem] shadow-2xl text-center border border-slate-100 animate-[fadeIn_0.5s_ease-out]">
            <div class="w-24 h-24 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-10 ring-8 ring-emerald-50/50">
                <i data-lucide="check-check" class="w-12 h-12 text-emerald-600"></i>
            </div>
            <h2 class="text-4xl font-black text-eluria-navy mb-4 tracking-tighter">CADASTRO REALIZADO</h2>
            <p class="text-slate-500 text-xl font-medium max-w-sm mx-auto leading-relaxed">As informações foram processadas com sucesso para a geração do contrato.</p>
            <button onclick="window.location.reload()" class="mt-14 bg-slate-900 hover:bg-black text-white font-bold py-5 px-12 rounded-2xl transition-all flex items-center gap-3 mx-auto shadow-xl hover:shadow-2xl">
                <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                Novo Formulário
            </button>
        </div>

        <!-- Form State -->
        <div id="formState">
            <header class="text-center mb-16">
                <div class="inline-block px-4 py-1.5 bg-eluria-navy text-white text-[10px] font-black tracking-[0.2em] rounded-full mb-6 uppercase">
                    Portal do Contratante
                </div>
                <h1 class="text-5xl md:text-6xl font-black text-eluria-navy tracking-tighter uppercase leading-none mb-6">
                    Dados de <span class="text-slate-400">Contratação</span>
                </h1>
                <div class="w-20 h-1.5 bg-eluria-navy mx-auto rounded-full mb-8"></div>
                <p class="text-slate-500 font-bold text-lg tracking-tight max-w-lg mx-auto leading-snug">
                    Por favor, preencha as informações abaixo para a elaboração do instrumento jurídico.
                </p>
            </header>

            <form id="contractForm" class="space-y-4">
                <!-- Seção 1: Dados Pessoais -->
                <div class="section-group">
                    <div class="section-header">
                        <i data-lucide="user-check" class="w-6 h-6"></i>
                        <h2 class="text-lg font-black uppercase tracking-wider">Identificação do Contratante</h2>
                    </div>
                    <div class="section-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="form-field md:col-span-2">
                                <label for="Nome completo" class="form-label">Nome Completo</label>
                                <div class="input-wrapper">
                                    <input type="text" id="Nome completo" name="Nome completo" class="form-input" placeholder="Conforme documento de identidade" required data-validate="name">
                                    <i data-lucide="user" class="prefix-icon"></i>
                                    <i data-lucide="check" class="validation-indicator icon-valid"></i>
                                    <i data-lucide="alert-circle" class="validation-indicator icon-invalid"></i>
                                </div>
                                <span class="error-hint">Informe o nome completo (pelo menos dois nomes)</span>
                            </div>

                            <div class="form-field">
                                <label for="Estado Civil" class="form-label">Estado Civil</label>
                                <div class="input-wrapper">
                                    <select id="Estado Civil" name="Estado Civil" class="form-input appearance-none" required data-validate="select">
                                        <option value="" disabled selected>Selecione uma opção</option>
                                        <option value="Solteiro">Solteiro(a)</option>
                                        <option value="Casado">Casado(a)</option>
                                        <option value="Divorciado">Divorciado(a)</option>
                                        <option value="Viúvo">Viúvo(a)</option>
                                        <option value="União Estável">União Estável</option>
                                    </select>
                                    <i data-lucide="heart" class="prefix-icon"></i>
                                    <i data-lucide="chevron-down" class="absolute right-4 w-4 h-4 text-slate-400 pointer-events-none"></i>
                                </div>
                            </div>

                            <div class="form-field">
                                <label for="Profissão" class="form-label">Profissão</label>
                                <div class="input-wrapper">
                                    <input type="text" id="Profissão" name="Profissão" class="form-input" placeholder="Ex: Advogado, Médico, etc." required data-validate="text">
                                    <i data-lucide="briefcase" class="prefix-icon"></i>
                                </div>
                            </div>

                            <div class="form-field">
                                <label for="RG e Órgão Expedidor" class="form-label">RG e Órgão Expedidor</label>
                                <div class="input-wrapper">
                                    <input type="text" id="RG e Órgão Expedidor" name="RG e Órgão Expedidor" class="form-input" placeholder="Ex: 00.000.000-0 SSP/SP" required data-validate="text">
                                    <i data-lucide="contact-2" class="prefix-icon"></i>
                                </div>
                            </div>

                            <div class="form-field">
                                <label for="CPFCPFCPF" class="form-label">CPF</label>
                                <div class="input-wrapper">
                                    <input type="text" id="CPFCPFCPF" name="CPFCPFCPF" class="form-input" placeholder="000.000.000-00" required data-validate="cpf">
                                    <i data-lucide="fingerprint" class="prefix-icon"></i>
                                    <i data-lucide="check" class="validation-indicator icon-valid"></i>
                                    <i data-lucide="alert-circle" class="validation-indicator icon-invalid"></i>
                                </div>
                                <span class="error-hint">CPF inválido</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seção 2: Endereço -->
                <div class="section-group">
                    <div class="section-header">
                        <i data-lucide="map-pin" class="w-6 h-6"></i>
                        <h2 class="text-lg font-black uppercase tracking-wider">Endereço Residencial</h2>
                    </div>
                    <div class="section-content">
                        <div class="grid grid-cols-1 md:grid-cols-6 gap-8">
                            <div class="form-field md:col-span-2">
                                <label for="CEPCEPCEP" class="form-label">CEP</label>
                                <div class="input-wrapper">
                                    <input type="text" id="CEPCEPCEP" name="CEPCEPCEP" class="form-input" placeholder="00000-000" required data-validate="cep">
                                    <i data-lucide="search" class="prefix-icon"></i>
                                    <i data-lucide="check" class="validation-indicator icon-valid"></i>
                                    <i data-lucide="alert-circle" class="validation-indicator icon-invalid"></i>
                                </div>
                            </div>

                            <div class="form-field md:col-span-4">
                                <label for="UF" class="form-label">Estado (UF)</label>
                                <div class="input-wrapper">
                                    <select id="UF" name="UF" class="form-input appearance-none" required data-validate="select">
                                        <option value="" disabled selected>Selecione</option>
                                        <option value="AC">Acre</option><option value="AL">Alagoas</option><option value="AP">Amapá</option><option value="AM">Amazonas</option>
                                        <option value="BA">Bahia</option><option value="CE">Ceará</option><option value="DF">Distrito Federal</option><option value="ES">Espírito Santo</option>
                                        <option value="GO">Goiás</option><option value="MA">Maranhão</option><option value="MT">Mato Grosso</option><option value="MS">Mato Grosso do Sul</option>
                                        <option value="MG">Minas Gerais</option><option value="PA">Pará</option><option value="PB">Paraíba</option><option value="PR">Paraná</option>
                                        <option value="PE">Pernambuco</option><option value="PI">Piauí</option><option value="RJ">Rio de Janeiro</option><option value="RN">Rio Grande do Norte</option>
                                        <option value="RS">Rio Grande do Sul</option><option value="RO">Rondônia</option><option value="RR">Roraima</option><option value="SC">Santa Catarina</option>
                                        <option value="SP">São Paulo</option><option value="SE">Sergipe</option><option value="TO">Tocantins</option>
                                    </select>
                                    <i data-lucide="flag" class="prefix-icon"></i>
                                    <i data-lucide="chevron-down" class="absolute right-4 w-4 h-4 text-slate-400 pointer-events-none"></i>
                                </div>
                            </div>

                            <div class="form-field md:col-span-4">
                                <label for="Logradouro (Rua/Avenida/Travessa)" class="form-label">Logradouro</label>
                                <div class="input-wrapper">
                                    <input type="text" id="Logradouro (Rua/Avenida/Travessa)" name="Logradouro (Rua/Avenida/Travessa)" class="form-input" placeholder="Rua, Avenida, etc." required data-validate="text">
                                    <i data-lucide="map" class="prefix-icon"></i>
                                </div>
                            </div>

                            <div class="form-field md:col-span-2">
                                <label for="Número" class="form-label">Número</label>
                                <div class="input-wrapper">
                                    <input type="text" id="Número" name="Número" class="form-input" placeholder="Ex: 505" required data-validate="text">
                                    <i data-lucide="hash" class="prefix-icon"></i>
                                </div>
                            </div>

                            <div class="form-field md:col-span-3">
                                <label for="Complemento" class="form-label">Complemento</label>
                                <div class="input-wrapper">
                                    <input type="text" id="Complemento" name="Complemento" class="form-input" placeholder="Apto, Bloco, etc.">
                                    <i data-lucide="info" class="prefix-icon"></i>
                                </div>
                            </div>

                            <div class="form-field md:col-span-3">
                                <label for="Bairro" class="form-label">Bairro</label>
                                <div class="input-wrapper">
                                    <input type="text" id="Bairro" name="Bairro" class="form-input" placeholder="Ex: Centro" required data-validate="text">
                                    <i data-lucide="home" class="prefix-icon"></i>
                                </div>
                            </div>

                            <div class="form-field md:col-span-6">
                                <label for="Cidade" class="form-label">Cidade</label>
                                <div class="input-wrapper">
                                    <input type="text" id="Cidade" name="Cidade" class="form-input" placeholder="Informe sua cidade" required data-validate="text">
                                    <i data-lucide="map-pinned" class="prefix-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seção 3: Contato -->
                <div class="section-group">
                    <div class="section-header">
                        <i data-lucide="at-sign" class="w-6 h-6"></i>
                        <h2 class="text-lg font-black uppercase tracking-wider">Canais de Contato</h2>
                    </div>
                    <div class="section-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="form-field">
                                <label for="Email do Contratante" class="form-label">E-mail Corporativo/Pessoal</label>
                                <div class="input-wrapper">
                                    <input type="email" id="Email do Contratante" name="Email do Contratante" class="form-input" placeholder="exemplo@email.com" required data-validate="email">
                                    <i data-lucide="mail" class="prefix-icon"></i>
                                    <i data-lucide="check" class="validation-indicator icon-valid"></i>
                                    <i data-lucide="alert-circle" class="validation-indicator icon-invalid"></i>
                                </div>
                                <span class="error-hint">E-mail inválido</span>
                            </div>

                            <div class="form-field">
                                <label for="Telefone do Contratante" class="form-label">Telefone (WhatsApp)</label>
                                <div class="input-wrapper">
                                    <input type="text" id="Telefone do Contratante" name="Telefone do Contratante" class="form-input" placeholder="(00) 00000-0000" required data-validate="phone">
                                    <i data-lucide="phone" class="prefix-icon"></i>
                                    <i data-lucide="check" class="validation-indicator icon-valid"></i>
                                </div>
                            </div>

                            <div class="form-field md:col-span-2">
                                <label for="Data do Contrato" class="form-label">Data de Assinatura Desejada</label>
                                <div class="input-wrapper">
                                    <input type="date" id="Data do Contrato" name="Data do Contrato" class="form-input cursor-pointer" required>
                                    <i data-lucide="calendar" class="prefix-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pt-10">
                    <button type="submit" id="submitBtn" class="w-full bg-eluria-navy hover:bg-black text-white font-black py-6 px-10 rounded-2xl shadow-2xl transition-all flex items-center justify-center gap-4 text-xl tracking-tighter group active:scale-[0.98] disabled:opacity-50">
                        <span id="btnText">CONCLUIR CADASTRO</span>
                        <i data-lucide="chevron-right" id="btnIcon" class="w-6 h-6 group-hover:translate-x-2 transition-transform"></i>
                        <div id="btnLoading" class="hidden animate-spin rounded-full h-6 w-6 border-4 border-white border-t-transparent"></div>
                    </button>
                    <div class="flex items-center justify-center gap-6 mt-10 opacity-40 grayscale">
                        <div class="flex items-center gap-2 text-[10px] font-black uppercase tracking-widest">
                            <i data-lucide="lock" class="w-3 h-3"></i>
                            Ambiente Seguro
                        </div>
                        <div class="flex items-center gap-2 text-[10px] font-black uppercase tracking-widest">
                            <i data-lucide="check-circle" class="w-3 h-3"></i>
                            LGPD Compliance
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        // Masks
        const cpfMask = IMask(document.getElementById('CPFCPFCPF'), { mask: '000.000.000-00' });
        const cepMask = IMask(document.getElementById('CEPCEPCEP'), { mask: '00000-000' });
        const telefoneMask = IMask(document.getElementById('Telefone do Contratante'), { mask: '(00) 00000-0000' });

        // Validation Logic
        const validators = {
            cpf: (v) => {
                const cpf = v.replace(/[^\d]+/g, '');
                if (cpf.length !== 11 || !!cpf.match(/(\d)\1{10}/)) return false;
                let cpfs = cpf.split('');
                let validator = cpfs.filter((v, i) => i < 9).map((v, i) => v * (10 - i)).reduce((a, b) => a + b);
                validator = 11 - (validator % 11);
                if (validator >= 10) validator = 0;
                if (validator !== parseInt(cpfs[9])) return false;
                validator = cpfs.filter((v, i) => i < 10).map((v, i) => v * (11 - i)).reduce((a, b) => a + b);
                validator = 11 - (validator % 11);
                if (validator >= 10) validator = 0;
                return validator === parseInt(cpfs[10]);
            },
            email: (v) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v),
            cep: (v) => /^\d{5}-\d{3}$/.test(v),
            name: (v) => v.trim().split(' ').length >= 2,
            text: (v) => v.trim().length > 0,
            select: (v) => v !== "" && v !== null
        };

        const form = document.getElementById('contractForm');
        const inputs = form.querySelectorAll('input, select');
        const progressBar = document.getElementById('progress-bar');
        const totalRequired = Array.from(inputs).filter(i => i.required).length;

        function updateProgress() {
            const completed = Array.from(inputs).filter(i => i.required && i.closest('.form-field')?.classList.contains('is-valid')).length;
            const progress = (completed / totalRequired) * 100;
            progressBar.style.width = `${progress}%`;
        }

        inputs.forEach(input => {
            const handler = () => {
                const field = input.closest('.form-field');
                if (!field) return;
                
                const type = input.dataset.validate;
                const value = input.value;
                
                if (!type) {
                    if (input.required && value) field.classList.add('is-valid');
                    return;
                }

                const isValid = validators[type](value);
                
                if (value.length > 0) {
                    field.classList.toggle('is-valid', isValid);
                    field.classList.toggle('is-invalid', !isValid);
                } else {
                    field.classList.remove('is-valid', 'is-invalid');
                }
                updateProgress();
            };

            input.addEventListener('input', handler);
            input.addEventListener('blur', handler);
            if (input.tagName === 'SELECT') input.addEventListener('change', handler);
        });

        // Form Submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const btnIcon = document.getElementById('btnIcon');
            const btnLoading = document.getElementById('btnLoading');
            const formState = document.getElementById('formState');
            const successState = document.getElementById('successState');

            let allValid = true;
            inputs.forEach(input => {
                if (input.required) {
                    const type = input.dataset.validate;
                    const value = input.value;
                    const isValid = type ? validators[type](value) : value.length > 0;
                    
                    if (!isValid) {
                        allValid = false;
                        input.closest('.form-field')?.classList.add('is-invalid');
                    }
                }
            });

            if (!allValid) {
                const firstError = document.querySelector('.is-invalid');
                firstError?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            // Webhook Configuration
            const WEBHOOK_URL = 'https://workflow.eluria.com.br/webhook-test/Dados_Contratos';

            // Loading state
            submitBtn.disabled = true;
            btnText.textContent = 'ENVIANDO DADOS...';
            btnIcon.classList.add('hidden');
            btnLoading.classList.remove('hidden');

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Format date
            const [year, month, day] = data["Data do Contrato"].split('-');
            data["Data do Contrato"] = `${day}/${month}/${year}`;
            
            data.CPFCPFCPF = cpfMask.unmaskedValue;
            data.CEPCEPCEP = cepMask.unmaskedValue;
            data["Telefone do Contratante"] = telefoneMask.unmaskedValue;
            data.submittedAt = new Date().toISOString();
            data.formMode = "production";

            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    console.log('Sucesso:', await response.text());
                    
                    formState.classList.add('hidden');
                    successState.classList.remove('hidden');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // Success Celebration
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#050A30', '#1a245a', '#ffffff']
                    });
                } else {
                    throw new Error('Erro no servidor');
                }
            } catch (error) {
                console.error('Erro no envio:', error);
                alert('Ocorreu um erro ao enviar os dados. Por favor, tente novamente.');
                
                // Reset button state
                submitBtn.disabled = false;
                btnText.textContent = 'TENTAR NOVAMENTE';
                btnIcon.classList.remove('hidden');
                btnLoading.classList.add('hidden');
            }
        });

        // Auto-CEP
        document.getElementById('CEPCEPCEP').addEventListener('blur', async function() {
            const cep = cepMask.unmaskedValue;
            if (cep.length === 8) {
                try {
                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                    const data = await response.json();
                    if (!data.erro) {
                        const fields = {
                            'Logradouro (Rua/Avenida/Travessa)': data.logradouro,
                            'Bairro': data.bairro,
                            'Cidade': data.localidade,
                            'UF': data.uf
                        };
                        
                        for (const [id, val] of Object.entries(fields)) {
                            const el = document.getElementById(id);
                            if (el) {
                                el.value = val;
                                el.dispatchEvent(new Event('input'));
                            }
                        }
                        document.getElementById('Número')?.focus();
                    }
                } catch (err) { console.error('CEP API Error'); }
            }
        });

        document.getElementById('Data do Contrato').valueAsDate = new Date();
    </script>
</body>
</html>